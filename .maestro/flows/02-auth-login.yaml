# Test: Login Flow
appId: com.nou09.Smuppy
name: "Auth - Login Flow"
tags:
  - auth
  - critical
---

- launchApp:
    clearState: true

# Step 1: Wait app bootstrap
- waitForAnimationToEnd:
    timeout: 10000

# Step 2: Dismiss optional overlays
- tapOn:
    text: "Continue"
    optional: true
- tapOn:
    text: "Go home"
    optional: true
- waitForAnimationToEnd:
    timeout: 5000

# Open login when welcome screen is shown (optional in modern builds)
- tapOn:
    id: "login-button"
    optional: true

# Wait for either login form or already-authenticated surface
- extendedWaitUntil:
    visible:
      id: "home-tab"
    timeout: 20000
    optional: true
- extendedWaitUntil:
    visible:
      id: "email-input"
    timeout: 20000
    optional: true

- takeScreenshot: "02-login-screen"

# Enter credentials only when login form is visible
- runFlow:
    when:
      visible:
        id: "email-input"
    commands:
      - tapOn:
          id: "email-input"
      - inputText: "${TEST_EMAIL}"
      - tapOn:
          id: "password-input"
      - inputText: "${TEST_PASSWORD}"
      - takeScreenshot: "02-credentials-entered"
      - tapOn:
          id: "submit-login-button"

# Wait for authenticated surface (or keep auth visible if creds invalid in this environment)
- extendedWaitUntil:
    visible:
      id: "home-tab"
    timeout: 20000
    optional: true

- extendedWaitUntil:
    visible:
      id: "profile-tab"
    timeout: 5000
    optional: true

- takeScreenshot: "02-login-success"
