#!/bin/sh

# ========================================
# Smuppy Pre-push Quality Gate
# ========================================
# Prevents pushing broken code to remote.
# Runs full test suite + TypeScript check.
# ========================================

set -e

echo "Running pre-push quality checks..."

# ========================================
# 1. TypeScript Type Check (BLOCKING)
# ========================================

echo "Step 1/3: TypeScript check..."
npx tsc --noEmit
echo "TypeScript check passed."

# ========================================
# 2. ESLint (BLOCKING)
# ========================================

echo "Step 2/3: ESLint check..."
npx eslint src/ --ext .js,.jsx,.ts,.tsx --quiet
echo "ESLint check passed."

# ========================================
# 3. Unit Tests with Coverage (BLOCKING)
# ========================================

echo "Step 3/3: Running unit tests..."
npx jest --ci --coverage --maxWorkers=2
echo "Unit tests passed."

# ========================================
# Summary
# ========================================

echo ""
echo "All pre-push checks passed. Pushing to remote..."
