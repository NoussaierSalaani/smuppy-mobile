#!/bin/sh

# Run lint-staged for code quality
npx lint-staged

# Check for secrets (basic patterns)
echo "Checking for potential secrets..."

STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx|js|jsx|json)$' || true)

if [ -n "$STAGED_FILES" ]; then
  # Check for AWS keys
  if echo "$STAGED_FILES" | xargs grep -lE 'AKIA[0-9A-Z]{16}' 2>/dev/null; then
    echo "ERROR: AWS Access Key detected!"
    exit 1
  fi

  # Check for private keys
  if echo "$STAGED_FILES" | xargs grep -l 'PRIVATE KEY' 2>/dev/null; then
    echo "ERROR: Private key detected!"
    exit 1
  fi

  # Check for Stripe live keys
  if echo "$STAGED_FILES" | xargs grep -lE 'sk_live_[a-zA-Z0-9]{24}' 2>/dev/null; then
    echo "ERROR: Stripe live key detected!"
    exit 1
  fi
fi

echo "Pre-commit checks passed."
